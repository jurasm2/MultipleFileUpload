(function(e,t,n,r){function o(){var e;try{e=navigator.plugins["Shockwave Flash"];e=e.description}catch(t){try{e=(new ActiveXObject("ShockwaveFlash.ShockwaveFlash")).GetVariable("$version")}catch(n){e="0.0"}}e=e.match(/\d+/g);return parseFloat(e[0]+"."+e[1])}var i={},s={};n.flash={trigger:function(e,t,n){setTimeout(function(){var r=i[e],s,o;if(r){r.trigger("Flash:"+t,n)}},0)}};n.runtimes.Flash=n.addRuntime("flash",{getFeatures:function(){return{jpgresize:true,pngresize:true,maxWidth:8091,maxHeight:8091,chunks:true,progress:true,multipart:true,multi_selection:true}},init:function(e,r){function c(){return t.getElementById(e.id+"_flash")}function h(){if(f++>5e3){r({success:false});return}if(!s[e.id]){setTimeout(h,1)}}var u,a,f=0,l=t.body;if(o()<10){r({success:false});return}s[e.id]=false;i[e.id]=e;u=t.getElementById(e.settings.browse_button);a=t.createElement("div");a.id=e.id+"_flash_container";n.extend(a.style,{position:"absolute",top:"0px",background:e.settings.shim_bgcolor||"transparent",zIndex:99999,width:"100%",height:"100%"});a.className="plupload flash";if(e.settings.container){l=t.getElementById(e.settings.container);if(n.getStyle(l,"position")==="static"){l.style.position="relative"}}l.appendChild(a);(function(){var r,i;r='<object id="'+e.id+'_flash" type="application/x-shockwave-flash" data="'+e.settings.flash_swf_url+'" ';if(n.ua.ie){r+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" '}r+='width="100%" height="100%" style="outline:0">'+'<param name="movie" value="'+e.settings.flash_swf_url+'" />'+'<param name="flashvars" value="id='+escape(e.id)+'" />'+'<param name="wmode" value="transparent" />'+'<param name="allowscriptaccess" value="always" />'+"</object>";if(n.ua.ie){i=t.createElement("div");a.appendChild(i);i.outerHTML=r;i=null}else{a.innerHTML=r}})();h();u=a=null;e.bind("Flash:Init",function(){var o={},u;c().setFileFilters(e.settings.filters,e.settings.multi_selection);if(s[e.id]){return}s[e.id]=true;e.bind("UploadFile",function(t,r){var i=t.settings,s=e.settings.resize||{};c().uploadFile(o[r.id],i.url,{name:r.target_name||r.name,mime:n.mimeTypes[r.name.replace(/^.+\.([^.]+)/,"$1").toLowerCase()]||"application/octet-stream",chunk_size:i.chunk_size,width:s.width,height:s.height,quality:s.quality,multipart:i.multipart,multipart_params:i.multipart_params||{},file_data_name:i.file_data_name,format:/\.(jpg|jpeg)$/i.test(r.name)?"jpg":"png",headers:i.headers,urlstream_upload:i.urlstream_upload})});e.bind("Flash:UploadProcess",function(e,t){var r=e.getFile(o[t.id]);if(r.status!=n.FAILED){r.loaded=t.loaded;r.size=t.size;e.trigger("UploadProgress",r)}});e.bind("Flash:UploadChunkComplete",function(e,t){var r,i=e.getFile(o[t.id]);r={chunk:t.chunk,chunks:t.chunks,response:t.text};e.trigger("ChunkUploaded",i,r);if(i.status!=n.FAILED){c().uploadNextChunk()}if(t.chunk==t.chunks-1){i.status=n.DONE;e.trigger("FileUploaded",i,{response:t.text})}});e.bind("Flash:SelectFiles",function(t,r){var i,s,u=[],a;for(s=0;s<r.length;s++){i=r[s];a=n.guid();o[a]=i.id;o[i.id]=a;u.push(new n.File(a,i.name,i.size))}if(u.length){e.trigger("FilesAdded",u)}});e.bind("Flash:SecurityError",function(t,r){e.trigger("Error",{code:n.SECURITY_ERROR,message:n.translate("Security error."),details:r.message,file:e.getFile(o[r.id])})});e.bind("Flash:GenericError",function(t,r){e.trigger("Error",{code:n.GENERIC_ERROR,message:n.translate("Generic error."),details:r.message,file:e.getFile(o[r.id])})});e.bind("Flash:IOError",function(t,r){e.trigger("Error",{code:n.IO_ERROR,message:n.translate("IO error."),details:r.message,file:e.getFile(o[r.id])})});e.bind("Flash:ImageError",function(t,r){e.trigger("Error",{code:parseInt(r.code,10),message:n.translate("Image error."),file:e.getFile(o[r.id])})});e.bind("Flash:StageEvent:rollOver",function(r){var i,s;i=t.getElementById(e.settings.browse_button);s=r.settings.browse_button_hover;if(i&&s){n.addClass(i,s)}});e.bind("Flash:StageEvent:rollOut",function(r){var i,s;i=t.getElementById(e.settings.browse_button);s=r.settings.browse_button_hover;if(i&&s){n.removeClass(i,s)}});e.bind("Flash:StageEvent:mouseDown",function(r){var i,s;i=t.getElementById(e.settings.browse_button);s=r.settings.browse_button_active;if(i&&s){n.addClass(i,s);n.addEvent(t.body,"mouseup",function(){n.removeClass(i,s)},r.id)}});e.bind("Flash:StageEvent:mouseUp",function(r){var i,s;i=t.getElementById(e.settings.browse_button);s=r.settings.browse_button_active;if(i&&s){n.removeClass(i,s)}});e.bind("Flash:ExifData",function(t,n){e.trigger("ExifData",e.getFile(o[n.id]),n.data)});e.bind("Flash:GpsData",function(t,n){e.trigger("GpsData",e.getFile(o[n.id]),n.data)});e.bind("QueueChanged",function(t){e.refresh()});e.bind("FilesRemoved",function(e,t){var n;for(n=0;n<t.length;n++){c().removeFile(o[t[n].id])}});e.bind("StateChanged",function(t){e.refresh()});e.bind("Refresh",function(e){var r,i,s;r=t.getElementById(e.settings.browse_button);if(r){i=n.getPos(r,t.getElementById(e.settings.container));s=n.getSize(r);n.extend(t.getElementById(e.id+"_flash_container").style,{top:i.y+"px",left:i.x+"px",width:s.w+"px",height:s.h+"px"})}});e.bind("Destroy",function(e){var r;n.removeAllEvents(t.body,e.id);delete s[e.id];delete i[e.id];r=t.getElementById(e.id+"_flash_container");if(r){l.removeChild(r)}});r({success:true})})}})})(window,document,plupload)
